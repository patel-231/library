<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Study Material Manager - Folder File View</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #f0f2f5;
  }
  header {
    background: #4a90e2;
    color: white;
    padding: 1rem;
    text-align: center;
  }
  #container {
    display: flex;
    height: calc(100vh - 70px);
  }
  #sidebar {
    width: 320px;
    background: white;
    border-right: 1px solid #ccc;
    overflow-y: auto;
    padding: 1rem;
  }
  #main {
    flex: 1;
    padding: 1rem;
    overflow-y: auto;
  }
  button {
    margin: 0.25rem 0;
    padding: 0.5rem 1rem;
    cursor: pointer;
  }
  ul.folder-tree {
    list-style: none;
    padding-left: 1rem;
  }
  ul.folder-tree li {
    margin: 0.25rem 0;
    cursor: default;
    display: flex;
    align-items: center;
  }
  ul.folder-tree li.folder > span.name {
    font-weight: bold;
    flex-grow: 1;
    user-select: none;
  }
  ul.folder-tree li.file > span.name {
    font-style: italic;
    color: #555;
    flex-grow: 1;
    user-select: none;
  }
  ul.folder-tree li span.name:hover {
    text-decoration: underline;
    cursor: pointer;
  }
  ul.folder-tree li button.delete-btn {
    background: transparent;
    border: none;
    color: #c00;
    font-size: 1rem;
    cursor: pointer;
    margin-left: 5px;
  }
  ul.folder-tree li button.delete-btn:hover {
    color: #900;
  }
  ul.folder-tree li button.toggle-btn {
    background: transparent;
    border: none;
    font-size: 1rem;
    cursor: pointer;
    margin-right: 5px;
    user-select: none;
  }
  #file-viewer {
    margin-top: 1rem;
  }
  #file-viewer img, #file-viewer embed {
    max-width: 100%;
    max-height: 70vh;
    border: 1px solid #ccc;
  }
  #folder-files {
    margin-top: 1rem;
  }
  #folder-files ul {
    list-style: none;
    padding-left: 0;
  }
  #folder-files ul li {
    padding: 0.3rem 0.5rem;
    cursor: pointer;
    border-bottom: 1px solid #ddd;
  }
  #folder-files ul li:hover {
    background-color: #e0e7ff;
  }
  /* Modal styles */
  .modal {
    display: none;
    position: fixed;
    z-index: 9999;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.5);
    justify-content: center;
    align-items: center;
  }
  .modal.active {
    display: flex;
  }
  .modal-content {
    background: white;
    padding: 1rem 1.5rem;
    border-radius: 5px;
    max-width: 400px;
    width: 90%;
  }
  .modal-content label {
    display: block;
    margin-top: 1rem;
  }
  .modal-content input, .modal-content select {
    width: 100%;
    padding: 0.5rem;
    margin-top: 0.25rem;
  }
  .modal-buttons {
    margin-top: 1rem;
    text-align: right;
  }
  .modal-buttons button {
    margin-left: 0.5rem;
  }
  #importJsonInput {
    display: none;
  }
</style>
</head>
<body>

<header>
  <h1>Study Material Manager</h1>
</header>

<div id="container">
  <aside id="sidebar">
    <button id="btnAddFolder">Add Folder</button><br />
    <button id="btnImportFiles">Import Files</button><br />
    <button id="btnExportAll">Export All</button><br />
    <button id="btnImportJson">Import JSON Backup</button>
    <input type="file" id="importJsonInput" accept=".json" />
    <ul id="folderTree" class="folder-tree"></ul>
  </aside>
  <main id="main">
    <h2 id="mainTitle">Select a folder to see its files</h2>
    <div id="folder-files"></div>
    <div id="file-viewer">Select a file to view</div>
  </main>
</div>

<!-- Add Folder Modal -->
<div id="modalAddFolder" class="modal">
  <div class="modal-content">
    <h3>Add New Folder</h3>
    <label for="folderNameInput">Folder Name:</label>
    <input type="text" id="folderNameInput" placeholder="e.g. Physics" />
    <label for="parentFolderSelect">Parent Folder:</label>
    <select id="parentFolderSelect"></select>
    <div class="modal-buttons">
      <button id="cancelAddFolder">Cancel</button>
      <button id="confirmAddFolder">Add Folder</button>
    </div>
  </div>
</div>

<!-- Import Files Modal -->
<div id="modalImportFiles" class="modal">
  <div class="modal-content">
    <h3>Import Files</h3>
    <input type="file" id="fileInput" multiple accept=".pdf,.jpg,.jpeg,.png,.gif" />
    <label for="importFolderSelect">Select Folder to Import Into:</label>
    <select id="importFolderSelect"></select>
    <div class="modal-buttons">
      <button id="cancelImportFiles">Cancel</button>
      <button id="confirmImportFiles">Import</button>
    </div>
  </div>
</div>

<script>
  const STORAGE_KEY = 'studyMaterialFolders';

  let folderTree = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [
    { id: 'root', name: 'Root', type: 'folder', children: [], expanded: true }
  ];

  let currentFolderId = 'root'; // Track which folder is selected to show files

  function generateId() {
    return Date.now().toString() + Math.random().toString(36).substr(2, 5);
  }

  function saveFolderTree() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(folderTree));
  }

  function findItemById(id, nodes = folderTree) {
    for (const node of nodes) {
      if (node.id === id) return node;
      if (node.type === 'folder' && node.children) {
        const found = findItemById(id, node.children);
        if (found) return found;
      }
    }
    return null;
  }

  function deleteItemById(id, nodes = folderTree) {
    for (let i = 0; i < nodes.length; i++) {
      if (nodes[i].id === id) {
        nodes.splice(i, 1);
        return true;
      }
      if (nodes[i].type === 'folder' && nodes[i].children) {
        const deleted = deleteItemById(id, nodes[i].children);
        if (deleted) return true;
      }
    }
    return false;
  }

  const folderTreeEl = document.getElementById('folderTree');
  const folderFilesEl = document.getElementById('folder-files');
  const mainTitleEl = document.getElementById('mainTitle');
  const fileViewer = document.getElementById('file-viewer');
  let currentViewedFileId = null;

  function renderFolderTree() {
    folderTreeEl.innerHTML = '';
    function createNodeElement(node) {
      const li = document.createElement('li');
      li.classList.add(node.type);

      if (node.type === 'folder') {
        const toggle = document.createElement('button');
        toggle.textContent = node.expanded ? '▼' : '▶';
        toggle.className = 'toggle-btn';
        toggle.onclick = (e) => {
          e.stopPropagation();
          node.expanded = !node.expanded;
          saveFolderTree();
          renderFolderTree();
        };
        li.appendChild(toggle);
      } else {
        const placeholder = document.createElement('span');
        placeholder.style.display = 'inline-block';
        placeholder.style.width = '18px';
        li.appendChild(placeholder);
      }

      const nameSpan = document.createElement('span');
      nameSpan.textContent = node.name;
      nameSpan.className = 'name';
      if (node.type === 'folder') {
        nameSpan.style.fontWeight = 'bold';
        nameSpan.style.flexGrow = '1';
        nameSpan.style.userSelect = 'none';
        nameSpan.style.cursor = 'pointer';
        nameSpan.onclick = () => {
          currentFolderId = node.id;
          renderFolderFiles(node);
          mainTitleEl.textContent = `Files in folder: ${node.name}`;
          clearFileViewer();
        };
      } else {
        nameSpan.style.fontStyle = 'italic';
        nameSpan.style.color = '#555';
        nameSpan.style.flexGrow = '1';
        nameSpan.style.userSelect = 'none';
        nameSpan.style.cursor = 'pointer';
        nameSpan.onclick = () => {
          viewFile(node);
        };
      }
      li.appendChild(nameSpan);

      if (node.id !== 'root') {
        const delBtn = document.createElement('button');
        delBtn.textContent = '🗑️';
        delBtn.className = 'delete-btn';
        delBtn.title = 'Delete ' + (node.type === 'folder' ? 'folder' : 'file');
        delBtn.onclick = (e) => {
          e.stopPropagation();
          if (confirm(`Are you sure you want to delete "${node.name}"?`)) {
            deleteItemById(node.id);
            saveFolderTree();
            renderFolderTree();
            if (node.type === 'folder' && currentFolderId === node.id) {
              currentFolderId = 'root';
              mainTitleEl.textContent = 'Select a folder to see its files';
              folderFilesEl.innerHTML = '';
              clearFileViewer();
            }
            if (node.type === 'file' && currentViewedFileId === node.id) {
              clearFileViewer();
            }
            if (node.type === 'folder' && currentFolderId !== 'root') {
              const currentFolder = findItemById(currentFolderId);
              if (currentFolder) renderFolderFiles(currentFolder);
              else {
                currentFolderId = 'root';
                mainTitleEl.textContent = 'Select a folder to see its files';
                folderFilesEl.innerHTML = '';
              }
            }
          }
        };
        li.appendChild(delBtn);
      }

      if (node.type === 'folder' && node.expanded && node.children.length > 0) {
        const ul = document.createElement('ul');
        ul.classList.add('folder-tree');
        node.children.forEach(child => {
          ul.appendChild(createNodeElement(child));
        });
        li.appendChild(ul);
      }

      return li;
    }
    folderTree.forEach(node => {
      folderTreeEl.appendChild(createNodeElement(node));
    });
  }

  function renderFolderFiles(folderNode) {
    folderFilesEl.innerHTML = '';
    if (!folderNode.children || folderNode.children.length === 0) {
      folderFilesEl.textContent = 'No files in this folder.';
      return;
    }
    const files = folderNode.children.filter(c => c.type === 'file');
    if (files.length === 0) {
      folderFilesEl.textContent = 'No files in this folder.';
      return;
    }
    const ul = document.createElement('ul');
    files.forEach(file => {
      const li = document.createElement('li');
      li.textContent = file.name;
      li.title = 'Click to view file';
      li.onclick = () => viewFile(file);
      ul.appendChild(li);
    });
    folderFilesEl.appendChild(ul);
  }

  function viewFile(fileNode) {
    if (!fileNode.data) {
      fileViewer.innerHTML = '<p><i>No data available for this file.</i></p>';
      currentViewedFileId = null;
      return;
    }
    currentViewedFileId = fileNode.id;
    const ext = fileNode.name.split('.').pop().toLowerCase();
    if (ext === 'pdf') {
      fileViewer.innerHTML = `<embed src="${fileNode.data}" type="application/pdf" width="100%" height="600px" />`;
    } else if (['jpg','jpeg','png','gif'].includes(ext)) {
      fileViewer.innerHTML = `<img src="${fileNode.data}" alt="${fileNode.name}" />`;
    } else {
      fileViewer.innerHTML = `<p>Cannot preview this file type.</p>`;
    }
  }
  function clearFileViewer() {
    fileViewer.innerHTML = 'Select a file to view';
    currentViewedFileId = null;
  }

  function populateFolderSelect(selectEl) {
    selectEl.innerHTML = '';
    function addOptions(nodes, prefix = '') {
      nodes.forEach(node => {
        if (node.type === 'folder') {
          const option = document.createElement('option');
          option.value = node.id;
          option.textContent = prefix + node.name;
          selectEl.appendChild(option);
          if (node.children.length > 0) {
            addOptions(node.children, prefix + '  ');
          }
        }
      });
    }
    addOptions(folderTree);
  }

  // Add Folder Modal Logic
  const modalAddFolder = document.getElementById('modalAddFolder');
  const btnAddFolder = document.getElementById('btnAddFolder');
  const folderNameInput = document.getElementById('folderNameInput');
  const parentFolderSelect = document.getElementById('parentFolderSelect');
  const cancelAddFolder = document.getElementById('cancelAddFolder');
  const confirmAddFolder = document.getElementById('confirmAddFolder');

  btnAddFolder.onclick = () => {
    folderNameInput.value = '';
    populateFolderSelect(parentFolderSelect);
    modalAddFolder.classList.add('active');
  };
  cancelAddFolder.onclick = () => modalAddFolder.classList.remove('active');
  confirmAddFolder.onclick = () => {
    const name = folderNameInput.value.trim();
    if (!name) {
      alert('Please enter a folder name.');
      return;
    }
    const parentId = parentFolderSelect.value;
    const parentNode = findItemById(parentId);
    if (!parentNode || parentNode.type !== 'folder') {
      alert('Invalid parent folder.');
      return;
    }
    parentNode.children.push({
      id: generateId(),
      name,
      type: 'folder',
      children: [],
      expanded: false
    });
    saveFolderTree();
    renderFolderTree();
    modalAddFolder.classList.remove('active');
  };

  // Import Files Modal Logic
  const modalImportFiles = document.getElementById('modalImportFiles');
  const btnImportFiles = document.getElementById('btnImportFiles');
  const fileInput = document.getElementById('fileInput');
  const importFolderSelect = document.getElementById('importFolderSelect');
  const cancelImportFiles = document.getElementById('cancelImportFiles');
  const confirmImportFiles = document.getElementById('confirmImportFiles');

  let filesToImport = [];

  btnImportFiles.onclick = () => {
    fileInput.value = '';
    filesToImport = [];
    populateFolderSelect(importFolderSelect);
    modalImportFiles.classList.add('active');
  };
  cancelImportFiles.onclick = () => modalImportFiles.classList.remove('active');

  fileInput.onchange = () => {
    filesToImport = Array.from(fileInput.files);
  };

  confirmImportFiles.onclick = () => {
    if (filesToImport.length === 0) {
      alert('Please select files to import.');
      return;
    }
    const parentId = importFolderSelect.value;
    const parentNode = findItemById(parentId);
    if (!parentNode || parentNode.type !== 'folder') {
      alert('Invalid folder selected.');
      return;
    }

    let filesProcessed = 0;
    filesToImport.forEach(file => {
      const reader = new FileReader();
      reader.onload = (e) => {
        parentNode.children.push({
          id: generateId(),
          name: file.name,
          type: 'file',
          data: e.target.result
        });
        filesProcessed++;
        if (filesProcessed === filesToImport.length) {
          saveFolderTree();
          renderFolderTree();
          if (currentFolderId === parentId) {
            renderFolderFiles(parentNode);
          }
          modalImportFiles.classList.remove('active');
          alert('Files imported successfully!');
        }
      };
      reader.readAsDataURL(file);
    });
  };

  // Export All button
  document.getElementById('btnExportAll').onclick = () => {
    const dataStr = JSON.stringify(folderTree, null, 2);
    const blob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'study-materials.json';
    a.click();
    URL.revokeObjectURL(url);
  };

  // Import JSON Backup button and input
  const btnImportJson = document.getElementById('btnImportJson');
  const importJsonInput = document.getElementById('importJsonInput');

  btnImportJson.onclick = () => {
    importJsonInput.value = '';
    importJsonInput.click();
  };

  importJsonInput.onchange = () => {
    const file = importJsonInput.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const importedData = JSON.parse(e.target.result);
        if (!Array.isArray(importedData)) throw new Error('Invalid data format');
        if (!importedData.find(f => f.id === 'root' && f.type === 'folder')) {
          alert('Invalid backup file: Root folder missing.');
          return;
        }
        folderTree = importedData;
        saveFolderTree();
        renderFolderTree();
        clearFileViewer();
        currentFolderId = 'root';
        mainTitleEl.textContent = 'Select a folder to see its files';
        folderFilesEl.innerHTML = '';
        alert('Backup imported successfully!');
      } catch (err) {
        alert('Failed to import backup: ' + err.message);
      }
    };
    reader.readAsText(file);
  };

  // Initial render
  renderFolderTree();
  clearFileViewer();
</script>

</body>
</html>
</content>
</create_file>
