<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #36454F; /* Dark Slate Gray */
            --secondary-color: #DAA520; /* Goldenrod */
            --background-color: #FFFFFF; /* White */
            --container-bg: #F8F8F8; /* Light Gray */
            --text-color: #2D2D2D; /* Dark Gray */
            --subtle-text-color: #6C757D; /* Muted Gray */
            --border-color: #E0E0E0; /* Lighter Gray */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            background-color: var(--container-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 30px;
        }

        h1,
        h2 {
            color: var(--text-color);
        }

        /* History Section Styling */
        .history-section .header {
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .history-section h1 {
            font-family: 'Brush Script MT', cursive;
            font-size: 3em;
            color: var(--primary-color);
        }

        .history-section .subheader {
            color: var(--subtle-text-color);
            font-size: 1.3em;
        }

        .history-section table {
            width: 100%;
            border-collapse: collapse;
        }

        .history-section th,
        .history-section td {
            border: 1px solid var(--border-color);
            padding: 15px;
            text-align: left;
        }

        .history-section th {
            background-color: #EFEFEF;
            color: var(--primary-color);
            text-transform: uppercase;
        }

        .history-section td {
            color: var(--text-color);
            background-color: var(--container-bg);
        }

        .history-section .fixed-header {
            background-color: #E8E8E8;
            font-style: italic;
            color: #444;
        }

        .history-section .date-section span {
            color: var(--subtle-text-color);
        }

        .history-section .date-section span:first-child {
            color: var(--text-color);
        }

        /* Entry Section Styling */
        .entry-section .input-container {
            border: 1px solid var(--border-color);
            background: #FDFDFD;
            border-radius: 8px;
            padding: 20px;
        }

        .entry-section .input-group input {
            border-color: var(--border-color);
            background-color: #F8F8F8;
            color: var(--text-color);
        }

        .entry-section .input-group label {
            color: var(--text-color);
        }

        .entry-section button {
            transition: all 0.3s ease;
        }

        .entry-section #saveBtn {
            background-color: var(--primary-color);
            color: white;
        }

        .entry-section #saveBtn:hover {
            background-color: #2c3e50;
        }

        .entry-section #historyBtn {
            background-color: #E0E0E0;
            color: var(--text-color);
        }

        .entry-section #historyBtn:hover {
            background-color: #CDCDCD;
        }

        .entry-section .edit-btn,
        .entry-section .delete-btn {
            padding: 8px 12px;
            border-radius: 6px;
            color: white;
            font-size: 0.9em;
            font-weight: 500;
        }

        .entry-section .edit-btn {
            background-color: #007BFF;
        }

        .entry-section .delete-btn {
            background-color: #DC3545;
        }

        /* Add New Section Styling */
        .add-new-section h1 {
            color: var(--primary-color);
        }

        .add-new-section label {
            color: var(--text-color);
        }

        .add-new-section input {
            background-color: #F8F8F8;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
        }

        .add-new-section input::placeholder {
            color: var(--subtle-text-color);
        }


        .add-new-section #submitBtn {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            font-weight: bold;
        }

        .add-new-section #submitBtn:hover {
            background-color: #b8860b;
        }

        .add-new-section #clearBtn {
            background-color: #E0E0E0;
            color: var(--text-color);
        }

        .add-new-section #clearBtn:hover {
            background-color: #CDCDCD;
        }

        .add-new-section .message-modal {
            font-size: 1em;
            font-weight: 600;
        }

        .add-new-section #historyList div {
            background-color: #F0F0F0;
            color: var(--text-color);
        }

        .add-new-section .history-item-actions button {
            padding: 4px 8px;
            font-size: 0.8em;
            border-radius: 4px;
            margin-left: 5px;
        }

        .add-new-section .history-item-actions .edit-btn-add {
            background-color: #007BFF;
            color: white;
        }

        .add-new-section .history-item-actions .delete-btn-add {
            background-color: #DC3545;
            color: white;
        }
    </style>
</head>

<body class="bg-gray-100">

    <div class="history-section container">
        <div class="header flex justify-between items-center">
            <h1 class="text-4xl">Library Management</h1>
            <div class="date-section flex flex-col items-end text-sm">
                <span>Today</span>
                <span id="todayDate"></span>
            </div>
        </div>
        <div class="subheader">
            - History
        </div>
        <table>
            <thead>
                <tr>
                    <th class="fixed-header">Shelf no</th>
                    <th class="fixed-header">Book code</th>
                    <th class="fixed-header">Title</th>
                    <th class="fixed-header">Take in time</th>
                    <th class="fixed-header">Take out time</th>
                </tr>
            </thead>
            <tbody id="historyTableMain">
                </tbody>
        </table>
    </div>

    <hr class="my-10 border-t border-gray-300">

    <div class="entry-section container">
        <h1 class="text-3xl font-bold text-center mb-5">Book Entry</h1>
        <div class="input-container">
            <div class="input-group">
                <label for="bookCodeEntry">Book code</label>
                <input type="text" id="bookCodeEntry" placeholder="Enter book code">
            </div>
            <div class="input-group">
                <label for="shelfNoEntry">Shelf no</label>
                <input type="text" id="shelfNoEntry" placeholder="Enter shelf no">
            </div>
        </div>

        <div class="flex justify-center mt-5 space-x-4">
            <button id="saveBtn" class="py-2 px-4 rounded-lg">Save</button>
            <button id="historyBtn" class="py-2 px-4 rounded-lg">Show History</button>
        </div>

        <div id="historySection" class="mt-8 border-t border-gray-300 pt-6" style="display: none;">
            <h2 class="text-xl font-bold mb-4">Book History (Edit/Delete)</h2>
            <table>
                <thead>
                    <tr>
                        <th>Book Code</th>
                        <th>Shelf No</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="historyTable">
                    </tbody>
            </table>
        </div>
    </div>

    <hr class="my-10 border-t border-gray-300">

    <div class="add-new-section container">
        <div id="messageModal" class="message-modal fixed top-0 left-0 w-full p-4 text-center text-sm font-semibold text-white bg-red-500 rounded-b-xl shadow-lg z-50">
            </div>
        <h1 class="text-3xl font-bold text-center mb-6">Add New Book</h1>
        <form id="bookForm" class="space-y-4">
            <div>
                <label for="bookTitle" class="block text-sm font-medium">Book Title</label>
                <input type="text" id="bookTitle" name="bookTitle" class="mt-1 block w-full px-4 py-2 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter book title">
            </div>
            <div>
                <label for="bookCodeAdd" class="block text-sm font-medium">Book Code</label>
                <input type="text" id="bookCodeAdd" name="bookCodeAdd" class="mt-1 block w-full px-4 py-2 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter book code" required>
            </div>
            <div>
                <label for="shelfNoAdd" class="block text-sm font-medium">Shelf No.</label>
                <input type="text" id="shelfNoAdd" name="shelfNoAdd" class="mt-1 block w-full px-4 py-2 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter shelf number">
            </div>
            <div>
                <label for="password" class="block text-sm font-medium">Password</label>
                <input type="password" id="password" name="password" class="mt-1 block w-full px-4 py-2 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter password" required>
            </div>
            <div class="flex space-x-4 pt-2">
                <button type="submit" id="submitBtn" class="w-full py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 ease-in-out">
                    Save
                </button>
                <button type="button" id="clearBtn" class="w-full py-2 px-4 rounded-lg shadow-md hover:bg-gray-500 transition duration-300 ease-in-out">
                    Clear
                </button>
            </div>
        </form>
        <div class="mt-8 border-t border-gray-300 pt-6">
            <h2 class="text-xl font-bold mb-4">Saved Books</h2>
            <div id="historyList" class="space-y-3 overflow-y-auto max-h-60 pr-2">
                </div>
        </div>
    </div>


    <script>
        // --- Helper functions for Date and Time formatting ---
        function getFormattedDate() {
            const now = new Date();
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const year = now.getFullYear();
            return `${day}-${month}-${year}`;
        }

        function getFormattedTime() {
            const now = new Date();
            let hours = now.getHours();
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12; // The hour '0' should be '12'
            return `${String(hours).padStart(2, '0')}:${minutes} ${ampm}`;
        }

        // --- JavaScript for the main History section (1st code) ---
        const todayDateSpan = document.getElementById('todayDate');
        const mainHistoryTableBody = document.getElementById('historyTableMain');
        const historyStorageKey = 'library_history';

        function renderMainHistoryTable() {
            const history = JSON.parse(localStorage.getItem(historyStorageKey)) || [];
            mainHistoryTableBody.innerHTML = '';
            history.forEach(entry => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${entry.shelfNo}</td>
                    <td>${entry.bookCode}</td>
                    <td>${entry.title}</td>
                    <td>${entry.takeInTime}</td>
                    <td>${entry.takeOutTime}</td>
                `;
                mainHistoryTableBody.appendChild(row);
            });
        }

        todayDateSpan.textContent = getFormattedDate();

        // --- JavaScript for the Entry section (2nd code) ---
        const bookCodeInputEntry = document.getElementById('bookCodeEntry');
        const shelfNoInputEntry = document.getElementById('shelfNoEntry');
        const saveBtn = document.getElementById('saveBtn');
        const historyBtn = document.getElementById('historyBtn');
        const historySection = document.getElementById('historySection');
        const historyTableBody = document.getElementById('historyTable');

        const temporaryEntryStorageKey = 'bookData';

        let entryBooks = JSON.parse(localStorage.getItem(temporaryEntryStorageKey)) || [];
        let editIndex = null;

        function saveBookEntry() {
            const bookCode = bookCodeInputEntry.value.trim();
            const shelfNo = shelfNoInputEntry.value.trim();

            if (!bookCode) {
                alert("Please enter a book code.");
                return;
            }

            const savedBooks = JSON.parse(localStorage.getItem('library_books')) || [];
            const foundBook = savedBooks.find(book => book.code === bookCode);

            if (!foundBook) {
                alert("Not exist book");
                return;
            }

            const currentHistory = JSON.parse(localStorage.getItem(historyStorageKey)) || [];
            const newHistoryEntry = {
                bookCode: foundBook.code,
                shelfNo: shelfNo || foundBook.shelf,
                title: foundBook.title,
                takeInTime: `${getFormattedDate()} at ${getFormattedTime()}`,
                takeOutTime: `${getFormattedDate()} at ${getFormattedTime()}`
            };
            currentHistory.push(newHistoryEntry);
            localStorage.setItem(historyStorageKey, JSON.stringify(currentHistory));

            const entry = {
                bookCode: bookCode,
                shelfNo: shelfNo
            };
            if (editIndex !== null) {
                entryBooks[editIndex] = entry;
                editIndex = null;
            } else {
                entryBooks.push(entry);
            }
            localStorage.setItem(temporaryEntryStorageKey, JSON.stringify(entryBooks));

            bookCodeInputEntry.value = '';
            shelfNoInputEntry.value = '';
            renderTableEntry();
            renderMainHistoryTable();
        }

        function renderTableEntry() {
            historyTableBody.innerHTML = '';
            entryBooks.forEach((b, index) => {
                historyTableBody.innerHTML += `
                    <tr>
                        <td>${b.bookCode}</td>
                        <td>${b.shelfNo}</td>
                        <td>
                            <button class="edit-btn" onclick="editBookEntry(${index})">Edit</button>
                            <button class="delete-btn" onclick="deleteBookEntry(${index})">Delete</button>
                        </td>
                    </tr>
                `;
            });
        }

        function editBookEntry(index) {
            bookCodeInputEntry.value = entryBooks[index].bookCode;
            shelfNoInputEntry.value = entryBooks[index].shelfNo;
            editIndex = index;
            historySection.style.display = 'none';
            historyBtn.innerText = 'Show History';
        }

        function deleteBookEntry(index) {
            if (confirm("Delete this entry?")) {
                entryBooks.splice(index, 1);
                localStorage.setItem(temporaryEntryStorageKey, JSON.stringify(entryBooks));
                renderTableEntry();
            }
        }

        function toggleHistory() {
            if (historySection.style.display === 'none' || historySection.style.display === '') {
                historySection.style.display = 'block';
                historyBtn.innerText = 'Hide History';
            } else {
                historySection.style.display = 'none';
                historyBtn.innerText = 'Show History';
            }
        }

        saveBtn.addEventListener('click', saveBookEntry);
        historyBtn.addEventListener('click', toggleHistory);
        renderTableEntry();
        renderMainHistoryTable();


        // --- JavaScript for the Add New section (3rd code) ---
        const bookForm = document.getElementById('bookForm');
        const bookTitleInput = document.getElementById('bookTitle');
        const bookCodeInputAdd = document.getElementById('bookCodeAdd');
        const shelfNoInputAdd = document.getElementById('shelfNoAdd');
        const passwordInput = document.getElementById('password');
        const clearBtn = document.getElementById('clearBtn');
        const historyList = document.getElementById('historyList');
        const messageModal = document.getElementById('messageModal');
        const submitBtn = document.getElementById('submitBtn');

        const CORRECT_PASSWORD = '12345';
        const STORAGE_KEY = 'library_books';
        let isEditing = false;
        let editingIndex = null;

        function showMessage(message, isError = false) {
            messageModal.textContent = message;
            messageModal.classList.add('show');
            if (isError) {
                messageModal.classList.remove('bg-green-500');
                messageModal.classList.add('bg-red-500');
            } else {
                messageModal.classList.remove('bg-red-500');
                messageModal.classList.add('bg-green-500');
            }
            setTimeout(() => {
                messageModal.classList.remove('show');
            }, 3000);
        }

        function getBooks() {
            try {
                const books = localStorage.getItem(STORAGE_KEY);
                return books ? JSON.parse(books) : [];
            } catch (e) {
                console.error("Could not retrieve books from localStorage", e);
                return [];
            }
        }

        function saveBooks(books) {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(books));
            } catch (e) {
                console.error("Could not save books to localStorage", e);
            }
        }

        function renderSavedBooksHistory() {
            const books = getBooks();
            historyList.innerHTML = '';
            if (books.length === 0) {
                historyList.innerHTML = '<p class="text-gray-500 text-center">No books saved yet.</p>';
                return;
            }
            books.forEach((book, index) => {
                const bookItem = document.createElement('div');
                bookItem.className = 'flex justify-between items-center bg-gray-100 p-3 rounded-lg shadow-sm';
                bookItem.innerHTML = `
                    <div class="flex-1">
                        <span class="font-medium text-gray-800">Book Code:</span> ${book.code} <br>
                        <span class="font-medium text-gray-800">Shelf No.:</span> ${book.shelf}
                    </div>
                    <div class="history-item-actions">
                        <button class="edit-btn-add" onclick="editSavedBook(${index})">Edit</button>
                        <button class="delete-btn-add" onclick="deleteSavedBook(${index})">Delete</button>
                    </div>
                `;
                historyList.appendChild(bookItem);
            });
        }

        function editSavedBook(index) {
            const books = getBooks();
            const bookToEdit = books[index];
            bookTitleInput.value = bookToEdit.title;
            bookCodeInputAdd.value = bookToEdit.code;
            shelfNoInputAdd.value = bookToEdit.shelf;

            isEditing = true;
            editingIndex = index;
            submitBtn.textContent = 'Update';
        }

        function deleteSavedBook(index) {
            if (confirm("Are you sure you want to delete this book?")) {
                const books = getBooks();
                books.splice(index, 1);
                saveBooks(books);
                renderSavedBooksHistory();
                showMessage('Book deleted successfully!', false);
                renderMainHistoryTable();
            }
        }

        bookForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const bookTitle = bookTitleInput.value.trim();
            const bookCode = bookCodeInputAdd.value.trim();
            const shelfNo = shelfNoInputAdd.value.trim();
            const password = passwordInput.value.trim();

            if (password !== CORRECT_PASSWORD) {
                showMessage('Incorrect password!', true);
                passwordInput.value = '';
                return;
            }

            if (bookCode === '') {
                showMessage('Book Code is required.', true);
                return;
            }

            let books = getBooks();

            if (isEditing) {
                const originalBookCode = books[editingIndex].code;
                if (bookCode !== originalBookCode && books.some(book => book.code === bookCode)) {
                    showMessage('This Book Code already exists.', true);
                    return;
                }

                books[editingIndex] = {
                    title: bookTitle,
                    code: bookCode,
                    shelf: shelfNo
                };
                isEditing = false;
                editingIndex = null;
                submitBtn.textContent = 'Save';
                showMessage('Book updated successfully!', false);

            } else {
                const bookExists = books.some(book => book.code === bookCode);
                if (bookExists) {
                    showMessage('This Book Code already exists.', true);
                    return;
                }

                const newBook = {
                    title: bookTitle,
                    code: bookCode,
                    shelf: shelfNo
                };

                books.push(newBook);
                showMessage('Book saved successfully!', false);
            }

            saveBooks(books);
            renderSavedBooksHistory();
            bookForm.reset();
            renderMainHistoryTable();
        });

        clearBtn.addEventListener('click', () => {
            bookForm.reset();
            isEditing = false;
            editingIndex = null;
            submitBtn.textContent = 'Save';
            showMessage('Form cleared.', false);
        });

        document.addEventListener('DOMContentLoaded', () => {
            renderMainHistoryTable();
            renderTableEntry();
            renderSavedBooksHistory();
        });
    </script>
</body>

</html>